@model HospitalManagement.Models.TestAndInvestigationModel
@{
    ViewBag.Title = "PendingTestandInvestigation";
}
<div class="content">
    <div class="row">
        <div class="col-lg-12">
            <h4 class="page-title">Add Test And Investigation Value</h4>
        </div>
    </div>

    <div class="row inv_tab mt-2">
        <div class="col-md-12">
            <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link active" href="#solid-justified-tab1" data-toggle="tab">OPD/IP Add Investigation Values</a></li>
                <li id="tab2click" class="nav-item"><a class="nav-link" href="#solid-justified-tab2" data-toggle="tab">Out Side Patient Add Investigation Values</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane show active" id="solid-justified-tab1">

                    @using (Ajax.BeginForm("FilterPendingTestandInvestigation", "TestAndInvestigation", new AjaxOptions { HttpMethod = "POST", OnSuccess = "sucessmethod", LoadingElementId = "progress" }))
                    {
                        @Html.AntiForgeryToken()
                        <div class="row">
                            @*<div class="col-sm-6 col-md-3">
                                    <div class="form-group form-focus select-focus">
                                        <label class="focus-label">Investigation Type</label>
                                        @{ List<SelectListItem> listIteminvtype = new List<SelectListItem>();
                                            listIteminvtype.Add(new SelectListItem
                                            {
                                                Text = "Pathology",
                                                Value = "pathology",
                                                Selected = true

                                            });
                                            listIteminvtype.Add(new SelectListItem
                                            {
                                                Text = "Radiology",
                                                Value = "radiology"
                                            }); }
                                        @Html.DropDownList("invtype", listIteminvtype, new { @class = "form-control floating" })
                                    </div>
                                </div>*@

                            <div class="col-sm-6 col-md-3 col-xl-2">
                                <div class="form-group form-focus select-focus">
                                    <label class="focus-label">Day</label>
                                    <select class="form-control" id="Days" onchange="GetDropdownData()">
                                        @*<option>Select</option>*@
                                        <option>Today</option>
                                        <option>Last Week</option>
                                        <option>Custom</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3 col-xl-2 collapse" id="colpfrom">
                                <div class="form-group form-focus">
                                    <label class="focus-label">From Date</label>
                                    <input id="datetimepicker11" class="form-control datetimepicker  floating" autocomplete="off">
                                    @Html.HiddenFor(model => model.fromdate)
                                    @*<i class="fa fa-calendar"></i>*@
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3 col-xl-2 collapse" id="colpto">
                                <div class="form-group form-focus">
                                    <label class="focus-label">To Date</label>
                                    <input id="datetimepicker12" class="form-control datetimepicker  floating" autocomplete="off">
                                    @Html.HiddenFor(model => model.todate)
                                    @*<i class="fa fa-calendar"></i>*@
                                </div>
                            </div>


                            <div class="col-sm-6 col-md-3 col-xl-2">
                                <div class="form-group form-focus select-focus">
                                    <label class="focus-label">Status</label>
                                    @{ List<SelectListItem> listItemstatus = new List<SelectListItem>();

                                        listItemstatus.Add(new SelectListItem
                                        {
                                            Text = "Pending",
                                            Value = "pending"
                                        });
                                        listItemstatus.Add(new SelectListItem
                                        {
                                            Text = "Success",
                                            Value = "success"
                                        }); }
                                    @Html.DropDownList("status", listItemstatus, new { @class = "form-control floating" })
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3 col-xl-1">
                                <button class="btn skin-gradient-btn btn-block submit-btn"><i class="fa fa-search"></i></button>
                            </div>
                        </div>}


                    <div class="row bindtable card-topline-skin shadow">
                        <div class="col-md-12">
                            <div class="table-responsive mt-2">
                                <table class="table table-border table-striped custom-table mb-0" id="example1">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Patient Name</th>
                                            <th hidden>appointment_datetime</th>
                                            <th>Age</th>
                                            <th>Doctor Name</th>
                                            <th>Appointment</th>
                                            <th>status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.RegisterAppointmentlst != null && Model.RegisterAppointmentlst.Count > 0)
                                        {
                                            foreach (var item in Model.RegisterAppointmentlst)
                                            {
                                                int i = 0;
                                                <tr>
                                                    <td class="plusicon text-center">
                                                        <img src="~/Image/plus.png" />
                                                        <div style="display: none" class="table-responsive table-scrolling p-t-30">
                                                            <table cellpadding="0" cellspacing="0" style=" width: 100%;" class=" table table-bordered table-striped custom-table  ChildGrid">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Investigation code</th>
                                                                        <th>Investigation Name</th>
                                                                        <th>Collection</th>
                                                                        @*<th>Reagent</th>*@
                                                                        <th>Type</th>
                                                                        <th>Action</th>
                                                                        <th>Status</th>
                                                                        <th>Approval Status</th>
                                                                    </tr>
                                                                </thead>
                                                                @{
                                                                    <tbody>
                                                                        @if (Model.investigationPriceList != null && Model.investigationPriceList.Count > 0)
                                                                        {
                                                                            var inv_price = Model.investigationPriceList.FindAll(A => A.appoinment_code == item.appointment_code).ToList();
                                                                            if (inv_price.Count > 0)
                                                                            {
                                                                                foreach (var price in inv_price)
                                                                                {
                                                                                    <tr class="">
                                                                                        <td>@price.investigation_investigationid</td>
                                                                                        <td>@price.investigationmaster_name</td>
                                                                                        <td>
                                                                                            @{
                                                                                                List<SelectListItem> lst = new List<SelectListItem>();

                                                                                                if (price.sup_lst != null && price.sup_lst.Count > 0)
                                                                                                {
                                                                                                    foreach (var sup in @price.sup_lst)
                                                                                                    {
                                                                                                        lst.Add(new SelectListItem { Text = sup.SupplierName, Value = Convert.ToString(sup.SupplierId), Selected = price.supplierid == sup.SupplierId ? true : false });
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            @Html.DropDownList("price.supplierid", lst, new { @class = "form-control required", @disabled = "disabled", @onchange = "callChangefunc1(this.value)" })
                                                                                        </td>
                                                                                        <td>
                                                                                            @if (price.invtype == "pathology")
                                                                                            {
                                                                                                <span class="badge badge-light-secondary">@price.invtype</span>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <span class="badge badge-light-primary">@price.invtype</span>
                                                                                            }
                                                                                        </td>
                                                                                        @if (price.price == 0)
                                                                                        {
                                                                                            <td> <span class="custom-badge status-red"> Not available here</span></td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td id=@price.appoinment_code@i>

                                                                                                @if (price.isapprove == 0)
                                                                                                {
                                                                                                    if (price.invtype != "radiology")
                                                                                                    {
                                                                                                        @Ajax.ActionLink("Add Investigation value", "ReagentLists", "TestAndInvestigation",
                                                                                                                                                  new
                                                                                                                                                  {
                                                                                                                                                      service_id = price.service_id,
                                                                                                                                                      Investigationid = price.investigationmaster_id,
                                                                                                                                                      Appointmentcode = price.appoinment_code,
                                                                                                                                                      unique_invstigation_id = price.investigation_investigationid,
                                                                                                                                                      InvType = price.invtype
                                                                                                                                                  },
                                                                                                                                                  new AjaxOptions
                                                                                                                                                  {
                                                                                                                                                      HttpMethod = "POST",
                                                                                                                                                      InsertionMode = InsertionMode.Replace,
                                                                                                                                                      UpdateTargetId = price.invtype == "radiology" ? "radiology_BindInvestigationpara" : "BindInvestigationpara",
                                                                                                                                                      OnSuccess = "showModal(\"" + price.invtype + "\")",
                                                                                                                                                      LoadingElementId = "progress"
                                                                                                                                                  },
                                                                                                                                                      new { @class = "btn btn-sm skyblue-gradient-btn" })
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        @Ajax.ActionLink("Add Investigation value", "AddInvestigationPara", "TestAndInvestigation",
                                                                                                                                                  new
                                                                                                                                                  {
                                                                                                                                                      service_id = price.service_id,
                                                                                                                                                      Investigationid = price.investigationmaster_id,
                                                                                                                                                      Appointmentcode = price.appoinment_code,
                                                                                                                                                      unique_invstigation_id = price.investigation_investigationid,
                                                                                                                                                      InvType = price.invtype,
                                                                                                                                                      reagent_id = 0
                                                                                                                                                  },
                                                                                                                                                  new AjaxOptions
                                                                                                                                                  {
                                                                                                                                                      HttpMethod = "POST",
                                                                                                                                                      InsertionMode = InsertionMode.Replace,
                                                                                                                                                      UpdateTargetId = price.invtype == "radiology" ? "radiology_BindInvestigationpara" : "BindInvestigationpara",
                                                                                                                                                      OnSuccess = "showModal(\"" + price.invtype + "\" )",
                                                                                                                                                      LoadingElementId = "progress"
                                                                                                                                                  },
                                                                                                                                                      new { @class = "btn btn-sm skyblue-gradient-btn" })
                                                                                                    }
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <span class="custom-badge status-blue"> Approved By Doctor</span>
                                                                                                }

                                                                                            </td>
                                                                                            var StatusbidnId = item.appointment_code+"-"+price.investigation_investigationid;
                                                                                            <td class="@StatusbidnId">
                                                                                                @if (price.is_added == 1)
                                                                                                {
                                                                                                    <span class="custom-badge status-green">Added</span>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <span class="custom-badge status-yellow">Pending</span>
                                                                                                }
                                                                                            </td>
                                                                                            <td>
                                                                                                @if (price.isapprove == 0 && price.IsDr_visit == 0)
                                                                                                {
                                                                                                    <span class="custom-badge status-yellow">Pending Approval</span>
                                                                                                }
                                                                                                else if (price.isapprove == 0 && price.IsDr_visit == 1)
                                                                                                {
                                                                                                    <span class="badge badge-danger">Not Approve By Doctor</span>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <span class="custom-badge status-green">Success</span>
                                                                                                }
                                                                                            </td>
                                                                                        }
                                                                                    </tr>
                                                                                    i++;
                                                                                }
                                                                            }
                                                                            else if (inv_price.Count == 0 || inv_price == null)
                                                                            {
                                                                                <tr><td colspan="3" style="text-align:center"><div><img src="~/wwwroot/assets/img/no-result.png" /></div></td></tr>
                                                                            }
                                                                        }
                                                                        else if (Model.investigationPriceList == null || Model.investigationPriceList.Count == 0)
                                                                        {
                                                                            <tr><td colspan="3" style="text-align:center"><div><img src="~/wwwroot/assets/img/no-result.png" /></div></td></tr>
                                                                        }
                                                                    </tbody>
                                                                }
                                                            </table>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        @{
                                                            var PatProfile = "/wwwroot/assets/img/user.jpg";
                                                            if (item.patient_profile != "" && item.patient_profile != null)
                                                            {
                                                                PatProfile = System.Configuration.ConfigurationManager.AppSettings["GetPatImgUrl"] + item.patient_profile;
                                                            }
                                                        }

                                                        <img class="avatar" src="@PatProfile" alt="User Image"><h2><a href="~/HMSPatient/VisitedPatientProfile/@item.patuniqrow" target="_blank">@item.patient_name </a><span class="d-block"> @item.patient_code</span> <span class="d-block text-secondary"> @item.pateint_mobile</span> </h2>
                                                    </td>
                                                    <td hidden>@Html.DisplayFor(model => item.appointment_datetime)</td>
                                                    <td><h2>@item.gender <span class="text-secondary">@item.patient_age</span></h2></td>
                                                    <td><h2>@item.doctor_name<span class="d-block text-secondary">@item.department_name</span></h2></td>
                                                    <td><h2>@item.appointment_date @item.appointment_time <span class="d-block text-secondary"> @item.appointment_code</span></h2></td>
                                                    <td>
                                                        @if (item.isstatus == 1)
                                                        {
                                                            <span class="badge badge-success">Success</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="badge badge-warning">Pending</span>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane" id="solid-justified-tab2">
                    @using (Ajax.BeginForm("FilteropdPendingTestandInvestigation", "TestAndInvestigation", new AjaxOptions { HttpMethod = "POST", OnSuccess = "sucessmethodopd", LoadingElementId = "progress" }))
                    {
                        @Html.AntiForgeryToken()
                        <div class="row">
                            @*<div class="col-sm-6 col-md-3">
                                    <div class="form-group form-focus select-focus">
                                        <label class="focus-label">Investigation Type</label>
                                        @{ List<SelectListItem> listIteminvtype = new List<SelectListItem>();
                                            listIteminvtype.Add(new SelectListItem
                                            {
                                                Text = "Pathology",
                                                Value = "pathology",
                                                Selected = true

                                            });
                                            listIteminvtype.Add(new SelectListItem
                                            {
                                                Text = "Radiology",
                                                Value = "radiology"
                                            }); }
                                        @Html.DropDownList("invtype", listIteminvtype, new { @class = "form-control floating", @id = "opdinvtype" })
                                    </div>
                                </div>*@

                            <div class="col-sm-6 col-md-3 col-xl-2">
                                <div class="form-group form-focus select-focus">
                                    <label class="focus-label">Day</label>
                                    <select class="form-control" id="OPDays" onchange="GetDropdownDataOP()">
                                        @*<option>Select</option>*@
                                        <option>Today</option>
                                        <option>Last Week</option>
                                        <option>Custom</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3 col-xl-2 collapse" id="colpfromOP">
                                <div class="form-group form-focus">
                                    <label class="focus-label">From Date</label>
                                    <input id="datetimepicker13" class="form-control datetimepicker  floating" autocomplete="off">
                                    @Html.HiddenFor(model => model.fromdateop)
                                    @*<i class="fa fa-calendar"></i>*@
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3 col-xl-2 collapse" id="colptoOP">
                                <div class="form-group form-focus">
                                    <label class="focus-label">To Date</label>
                                    <input id="datetimepicker14" class="form-control datetimepicker  floating" autocomplete="off">
                                    @Html.HiddenFor(model => model.todateop)
                                    @*<i class="fa fa-calendar"></i>*@
                                </div>
                            </div>

                            <div class="col-sm-6 col-md-3 col-xl-2">
                                <div class="form-group form-focus select-focus">
                                    <label class="focus-label">Status</label>
                                    @{ List<SelectListItem> listItemstatus = new List<SelectListItem>();

                                        listItemstatus.Add(new SelectListItem
                                        {
                                            Text = "Pending",
                                            Value = "pending"
                                        });
                                        listItemstatus.Add(new SelectListItem
                                        {
                                            Text = "Success",
                                            Value = "success"
                                        }); }
                                    @Html.DropDownList("status", listItemstatus, new { @class = "form-control floating", @id = "opdstatus" })
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3 col-xl-1">
                                <button class="btn skin-gradient-btn btn-block submit-btn"><i class="fa fa-search"></i></button>
                            </div>
                        </div>
                    }
                    <div class="row bindtableop card-topline-skin shadow">
                        <div class="col-md-12">
                            <div class="table-responsive mt-2">
                                <table class="table table-border table-striped custom-table mb-0" id="example2">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Patient Name</th>
                                            <th hidden>appointment_datetime</th>
                                            <th>Age</th>
                                            <th>Invoice</th>
                                            <th>Referral Dr.</th>
                                            <th>status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.OP_InvestigationCollection != null && Model.OP_InvestigationCollection.Count > 0)
                                        {
                                            foreach (var item in Model.OP_InvestigationCollection)
                                            {
                                                int i = 0;
                                                <tr>
                                                    <td class="plusicon text-center">
                                                        <img src="~/Image/plus.png" />
                                                        <div style="display: none" class="table-responsive table-scrolling p-t-30">
                                                            <table cellpadding="0" cellspacing="0" style=" width: 100%;" class=" table table-bordered table-striped custom-table  ChildGrid">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Investigation code</th>
                                                                        <th>Investigation Name</th>
                                                                        <th>Collection</th>
                                                                        <th>Type</th>
                                                                        <th>Action</th>
                                                                        <th>Status</th>
                                                                        <th>Approval Status</th>
                                                                    </tr>
                                                                </thead>
                                                                @{
                                                                    <tbody>
                                                                        @if (Model.OP_InvestigationItems != null && Model.OP_InvestigationItems.Count > 0)
                                                                        {
                                                                            var inv_price = Model.OP_InvestigationItems.FindAll(A => A.invoice_code == item.invoice_code).ToList();
                                                                            if (inv_price.Count > 0)
                                                                            {
                                                                                foreach (var price in inv_price)
                                                                                {
                                                                                    <tr class="">
                                                                                        <td>@price.test_id</td>
                                                                                        <td>@price.investigation_name</td>
                                                                                        <td>
                                                                                            @{
                                                                                                List<SelectListItem> lst = new List<SelectListItem>();

                                                                                                foreach (var sup in @price.sup_lst)
                                                                                                {
                                                                                                    lst.Add(new SelectListItem { Text = sup.SupplierName, Value = Convert.ToString(sup.SupplierId), Selected = price.supplierid == sup.SupplierId ? true : false });
                                                                                                }
                                                                                            }
                                                                                            @Html.DropDownList("price.supplierid", lst, new { @class = "form-control required", @disabled = "disabled", @onchange = "callChangefunc1(this.value)" })
                                                                                        </td>
                                                                                        <td>
                                                                                            @if (price.invtype == "pathology")
                                                                                            {<span class="badge badge-light-secondary">@price.invtype</span>}
                                                                                        else
                                                                                        { <span class="badge badge-light-primary">@price.invtype</span>}
                                                                                        </td>
                                                                                        @if (price.Amount == 0)
                                                                                        {
                                                                                            <td> <span class="custom-badge status-red"> Not available here</span></td>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <td id=@price.invoice_code@i>
                                                                                                @if (price.isapprove == 0)
                                                                                                {
                                                                                                    if (price.invtype == "radiology")
                                                                                                    {
                                                                                                        @Ajax.ActionLink("Add Investigation value", "AddInvestigationPara_OP", "TestAndInvestigation",
                                                                                                                            new
                                                                                                                                 {
                                                                                                                                     service_id = price.service_id,
                                                                                                                                     investigation_id = price.investigation_id,
                                                                                                                                invoice_code = price.invoice_code,
                                                                                                                                     unique_invstigation_id = price.test_id,
                                                                                                                                InvType = price.invtype,
                                                                                                                                reagent_id = 0
                                                                                                                                 },
                                                                                                                            new AjaxOptions
                                                                                                                            {
                                                                                                                                HttpMethod = "POST",
                                                                                                                                InsertionMode = InsertionMode.Replace,
                                                                                                                                UpdateTargetId = price.invtype == "radiology" ? "radiology_BindInvestigationparaOP" : "BindInvestigationparaOP",
                                                                                                                                OnSuccess = "showModalOP(\"" + price.invtype + "\")",
                                                                                                                                LoadingElementId = "progress"
                                                                                                                            },
                                                                                                                                new { @class = "btn btn-sm skyblue-gradient-btn" })
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        @Ajax.ActionLink("Add Investigation value", "ReagentLists_op", "TestAndInvestigation",
                                                                                                                       new
                                                                                                                            {
                                                                                                                                service_id = price.service_id,
                                                                                                                                investigation_id = price.investigation_id,
                                                                                                                           invoice_code = price.invoice_code,
                                                                                                                           unique_invstigation_id = price.test_id,
                                                                                                                                InvType = price.invtype
                                                                                                                            },
                                                                                                                       new AjaxOptions
                                                                                                                       {
                                                                                                                           HttpMethod = "POST",
                                                                                                                           InsertionMode = InsertionMode.Replace,
                                                                                                                           UpdateTargetId = price.invtype == "radiology" ? "radiology_BindInvestigationparaOP" : "BindInvestigationparaOP",
                                                                                                                           OnSuccess = "showModalOP(\"" + price.invtype + "\")",
                                                                                                                           LoadingElementId = "progress"
                                                                                                                       },
                                                                                                                           new { @class = "btn btn-sm skyblue-gradient-btn" })
                                                                                                    }
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <span class="custom-badge status-blue"> Approved By Doctor</span>
                                                                                                }
                                                                                            </td>
                                                                                            var Op_StatusbidnId = item.invoice_code + "-" + price.test_id;
                                                                                            <td class="@Op_StatusbidnId">
                                                                                                @if (price.is_added == 1)
                                                                                                {
                                                                                                    <span class="custom-badge status-green">Added</span>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <span class="custom-badge status-yellow">Pending</span>
                                                                                                }
                                                                                            </td>
                                                                                            <td>
                                                                                                @if (price.isapprove == 0 && price.IsDr_visit == 0)
                                                                                                {
                                                                                                    <span class="custom-badge status-yellow">Pending Approval</span>
                                                                                                }
                                                                                                else if (price.isapprove == 0 && price.IsDr_visit == 1)
                                                                                                {
                                                                                                    <span class="badge badge-danger">Not Approve By Doctor</span>
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    <span class="custom-badge status-green">Success</span>
                                                                                                }
                                                                                            </td>
                                                                                        }
                                                                                    </tr>
                                                                                    i++;
                                                                                }
                                                                            }
                                                                            else if (inv_price.Count == 0 || inv_price == null)
                                                                            {
                                                                                <tr><td colspan="3" style="text-align:center"><div><img src="~/wwwroot/assets/img/no-result.png" /></div></td></tr>
                                                                            }
                                                                        }
                                                                        else if (Model.investigationPriceList == null || Model.investigationPriceList.Count == 0)
                                                                        {
                                                                            <tr><td colspan="3" style="text-align:center"><div><img src="~/wwwroot/assets/img/no-result.png" /></div></td></tr>
                                                                        }
                                                                    </tbody>
                                                                }
                                                            </table>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        @{
                                                            var PatProfile = "/wwwroot/assets/img/user.jpg";
                                                            if (item.patient_profile != "" && item.patient_profile != null)
                                                            {
                                                                PatProfile = System.Configuration.ConfigurationManager.AppSettings["GetPatImgUrl"] + item.patient_profile;
                                                            }
                                                        }

                                                        <img class="avatar" src="@PatProfile" alt="User Image"><h2><a href="~/HMSPatient/VisitedPatientProfile/@item.patuniqrow" target="_blank">@item.patient_name </a><span class="d-block"> @item.patient_code</span> <span class="d-block text-secondary"> @item.pateint_mobile</span> </h2>
                                                    </td>
                                                    <td hidden>@Html.DisplayFor(model => item.cdate)</td>
                                                    <td><h2>@item.gender <span class="text-secondary">@item.patient_age</span></h2></td>
                                                    <td>
                                                        <h2>
                                                            @item.invoice_code
                                                            <span class="d-block text-secondary"> @item.inv_date</span>
                                                        </h2>
                                                    </td>
                                                    <td>@item.referal_doctor</td>
                                                    <td>
                                                        @if (item.isstatus == 1)
                                                        {
                                                            <span class="badge badge-success">Success</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="badge badge-warning">Pending</span>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<!--Added by Dhaval-->
@Html.Partial("_Investigation_radiologyparaModel", Model)
@Html.Partial("_Investigation_radiologyparaOPModel", Model)
<!--End-->
@Html.Partial("_InvestigationparaModel", Model)
@Html.Partial("_InvestigationparaOPModel", Model)
@section scripts{
    <script src="~/wwwroot/assets/js/date-eu.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote.min.js"></script>
    <script type="text/javascript">
        //$(".InvestigationStation").addClass("subdrop");
        //$(".Submenu_InvestigationStation").css("display", "block");
        //$(".Submenu_InvestigationStation").css("display", "block");
        //$(".PendingTestandInvestigation").addClass("active");
        var htmlstr = "";
        $(document).ready(function () {
            $("#Doctor").select2();

            $('#example1').DataTable({
                "paging": true,
                "order": [[2, "desc"]],
                "scrollCollapse": true,
                "searching": true,
                "columnDefs": [{ "targets": 2, "type": "date-eu" }],
                "bInfo": true
            });

        });
        $("#Doctor").select2();
        //$('#radiology_model').modal('show');
        function showModal(InvType, StatusId) {
            debugger;
            if (InvType == "radiology") {
                $('#radiology_model').modal('show');
                $('#invSubgroupList_0__invParaList_0__investigationsubgroup_name').summernote({
                    height: 520,                 // set editor height
                    minHeight: null,             // set minimum height of editor
                    maxHeight: null,             // set maximum height of editor
                    focus: true
                });
            }
            else
                $('#delete_employee').modal('show');
        }
        function showModalOP(InvType) {
            debugger;
            if (InvType == "radiology") {
                $('#op_radiologyinv_paralist').modal('show');
                $('#invSubgroupList_0__invParaList_0__investigationsubgroup_name').summernote({
                    height: 520,                 // set editor height
                    minHeight: null,             // set minimum height of editor
                    maxHeight: null,             // set maximum height of editor
                    focus: true
                });
            }
            else
                $('#inv_paralist').modal('show');
        }
        function SuccessMethod(data) {
            debugger;

            if (data == "1") {
                $('#cardbox1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-success alert-dismissible fade show' role='alert'> <strong>Success!</strong> Your <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Record Added Successfully!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
                var Code = $("#appointment_code").val();
                var UniqCode = $("#invSubgroupList_data_investigation_uniqcode").val();
                $("." + Code + "-" + UniqCode).html('<span class="custom-badge status-green">Added</span>');
            }
            else if (data == "0") {
                $('#cardbox1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Record Not Saved!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else if (data == "2") {
                $('#cardbox1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-info alert-dismissible fade show' role='alert'> <strongPlease read the</strong> comments <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Please Fill Data!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else if (data == "3") {
                $('#cardbox1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-warning alert-dismissible fade show' role='alert'> <span id='statusmsg'>Please Select Reagent!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else {
                $('#cardbox1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Error occured!!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            $("#cardbox1").html(htmlstr);
        }
        function SuccessMethodradio(data) {
            debugger;

            if (data == "1") {
                $('#cardbox').removeAttr('hidden');
                htmlstr = "<div class='alert alert-success alert-dismissible fade show' role='alert'> <strong>Success!</strong> Your <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Record Added Successfully!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
                var Code = $("#appointment_code").val();
                var UniqCode = $("#invSubgroupList_0__invParaList_0__investigation_uniqcode").val();
                $("." + Code + "-" + UniqCode).html('<span class="custom-badge status-green">Added</span>');
            }
            else if (data == "0") {
                $('#cardbox').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Record Not Saved!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else if (data == "2") {
                $('#cardbox').removeAttr('hidden');
                htmlstr = "<div class='alert alert-info alert-dismissible fade show' role='alert'> <strongPlease read the</strong> comments <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Please Fill Data!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else {
                $('#cardbox').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Error occured!!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            $("#cardbox").html(htmlstr);
        }
        function SuccessMethod_OP(data) {
            debugger;

            if (data == "1") {
                $('#cardboxop').removeAttr('hidden');
                htmlstr = "<div class='alert alert-success alert-dismissible fade show' role='alert'> <strong>Success!</strong> Your <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Record Added Successfully!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
                var Code = $("#invoice_code").val();
                var UniqCode = $("#invSubgroupList_data_investigation_uniqcode").val();
                $("." + Code + "-" + UniqCode).html('<span class="custom-badge status-green">Added</span>');
            }
            else if (data == "0") {
                $('#cardboxop').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Record Not Saved!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else if (data == "2") {
                $('#cardboxop').removeAttr('hidden');
                htmlstr = "<div class='alert alert-info alert-dismissible fade show' role='alert'> <strongPlease read the</strong> comments <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Please Fill Data!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else if (data == "3") {
                $('#cardboxop').removeAttr('hidden');
                htmlstr = "<div class='alert alert-warning alert-dismissible fade show' role='alert'> <span id='statusmsg'>Please Select Reagent!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else {
                $('#cardboxop').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Error occured!!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            $("#cardboxop").html(htmlstr);
        }
        function SuccessMethodradio_OP(data) {
            debugger;

            if (data == "1") {
                $('#cardboxop1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-success alert-dismissible fade show' role='alert'> <strong>Success!</strong> Your <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Record Added Successfully!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
                var Code = $("#invoice_code").val();
                var UniqCode = $("#invSubgroupList_0__invParaList_0__investigation_uniqcode").val();
                $("." + Code + "-" + UniqCode).html('<span class="custom-badge status-green">Added</span>');
            }
            else if (data == "0") {
                $('#cardboxop1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Record Not Saved!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else if (data == "2") {
                $('#cardboxop1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-info alert-dismissible fade show' role='alert'> <strongPlease read the</strong> comments <a href='#' class='alert-link'>Data</a> <span id='statusmsg'>Please Fill Data!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            else {
                $('#cardboxop1').removeAttr('hidden');
                htmlstr = "<div class='alert alert-danger alert-dismissible fade show' role='alert'> <strong>Error!</strong> problem <a href='#' class='alert-link'>Data</a>  has been occurred while submitting your data :<span id='statusmsg'>Error occured!!</span> <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button></div > ";
            }
            $("#cardboxop1").html(htmlstr);
        }
        //Assign Click event to Plus Image.
        $("body").on("click", "img[src*='plus.png']", function () {
            $(this).closest("tr").after("<tr><td></td><td colspan = '999'>" + $(this).next().html() + "</td></tr>");
            $(this).attr("src", "/Image/minus.png");
        });
        //Assign Click event to Minus Image.
        $("body").on("click", "img[src*='minus.png']", function () {
            $(this).attr("src", "/Image/plus.png");
            $(this).closest("tr").next().remove();
        });
        function SucessMethod(id) {
            debugger;
            $("#" + id + "").remove();
            $("#" + id + "").html(" <span class='custom-badge status-blue'> Added</span > ");
        }
        $("#tab2click").click(function () {
            $('.loadingimg').css('display', 'block');
            //$("#opdinvtype").val('pathology');
            $("#opdstatus").val('pending');
            url = "/TestAndInvestigation/PendingTestandInvestigation_OP";
            $.ajax({
                url: url,
                datatype: 'json',
                ContentType: 'application/json;utf-8'
            }).done(function (datahtml) {
                $('.loadingimg').css('display', 'none');
                $(".bindtableop").empty();
                $(".bindtableop").html($(datahtml).find(".bindtableop").html());
                $(".select2").select2();
                $('#example2').DataTable({
                    "paging": true,
                    "order": [[2, "desc"]],
                    "scrollCollapse": true,
                    "searching": true,
                    "columnDefs": [{ "targets": 2, "type": "date-eu" }],
                    "bInfo": true
                });
            });
        });
        function sucessmethod(data) {
            $(".bindtable").empty();
            $(".bindtable").html($(data).find(".bindtable").html());
            $('#example1').DataTable({
                "paging": true,
                "order": [[2, "desc"]],
                "scrollCollapse": true,
                "searching": true,
                "columnDefs": [{ "targets": 2, "type": "date-eu" }],
                "bInfo": true
            });
        }
        function sucessmethodopd(data) {
            $(".bindtableop").empty();
            $(".bindtableop").html($(data).find(".bindtableop").html());
            $('#example2').DataTable({
                "paging": true,
                "order": [[2, "desc"]],
                "scrollCollapse": true,
                "searching": true,
                "columnDefs": [{ "targets": 2, "type": "date-eu" }],
                "bInfo": true
            });
        }
        function GetDropdownData(type) {
            var day = $("#Days").val() == 'Select Day' ? 'Select Day' : $("#Days").val();
            var firstDay = new Date();
            var lastDay = new Date();

            if ($('#Days').val() == 'Select') {
                firstDay = "";
                lastDay = "";
                $('#fromdate').val(firstDay);
                $('#todate').val(lastDay);
            }

            if ($('#Days').val() == 'Today') {
                firstDay = new Date().toDateString();
                lastDay = new Date().toDateString();
                $('#fromdate').val(firstDay);
                $('#todate').val(lastDay);
            }
            if ($('#Days').val() == 'Last Week') {
                var curr = new Date; // get current date
                var first = curr.getDate(); //- curr.getDay(); // First day is the day of the month - the day of the week
                var last = first - 6; // last day is the first day + 6
                firstDay = new Date(curr.setDate(first)).toUTCString();
                lastDay = new Date(curr.setDate(last)).toUTCString();
                $('#fromdate').val(lastDay);
                $('#todate').val(firstDay);
            }
            if ($('#Days').val() == 'Custom') {
                $('#colpfrom').removeClass('collapse');
                $('#colpto').removeClass('collapse');
            }
            else {
                $('#colpfrom').addClass('collapse');
                $('#colpto').addClass('collapse');
            }
        }
        $('#datetimepicker11').on('dp.change', function (e) {
            debugger;
            var firstDay = new Date();
            if ($('#datetimepicker11').val() != null && $('#datetimepicker11').val() != "") {
                var from = $("#datetimepicker11").val().split("/")
                var f = new Date(from[2], from[1] - 1, from[0])
                firstDay = f.toDateString();
                $('#fromdate').val(firstDay);
            }
            else {
                alert("Please Enter from date");
                return false;
            }
        });
        $('#datetimepicker12').on('dp.change', function (e) {
            debugger;
            var lastDay = new Date();
            if ($('#datetimepicker12').val() != null && $('#datetimepicker12').val() != "") {
                var to = $("#datetimepicker12").val().split("/")
                var t = new Date(to[2], to[1] - 1, to[0])
                lastDay = t.toDateString();
                $('#todate').val(lastDay);
            }
            else {
                alert("Please Enter from date");
                return false;
            }
        });
        function GetDropdownDataOP(type) {
            var day = $("#OPDays").val() == 'Select Day' ? 'Select Day' : $("#OPDays").val();
            var firstDay = new Date();
            var lastDay = new Date();

            if ($('#OPDays').val() == 'Select') {
                firstDay = "";
                lastDay = "";
                $('#fromdateop').val(firstDay);
                $('#todateop').val(lastDay);
            }

            if ($('#OPDays').val() == 'Today') {
                firstDay = new Date().toDateString();
                lastDay = new Date().toDateString();
                $('#fromdateop').val(firstDay);
                $('#todateop').val(lastDay);
            }
            if ($('#OPDays').val() == 'Last Week') {
                var curr = new Date; // get current date
                var first = curr.getDate(); //- curr.getDay(); // First day is the day of the month - the day of the week
                var last = first - 6; // last day is the first day + 6
                firstDay = new Date(curr.setDate(first)).toUTCString();
                lastDay = new Date(curr.setDate(last)).toUTCString();
                $('#fromdateop').val(lastDay);
                $('#todateop').val(firstDay);
            }
            if ($('#OPDays').val() == 'Custom') {
                $('#colpfromOP').removeClass('collapse');
                $('#colptoOP').removeClass('collapse');
            }
            else {
                $('#colpfromOP').addClass('collapse');
                $('#colptoOP').addClass('collapse');
            }

        }
        $('#datetimepicker13').on('dp.change', function (e) {
            var firstDay = new Date();
            if ($('#datetimepicker13').val() != null && $('#datetimepicker13').val() != "") {
                var from = $("#datetimepicker13").val().split("/")
                var f = new Date(from[2], from[1] - 1, from[0])
                firstDay = f.toDateString();
                $('#fromdateop').val(firstDay);
            }
            else {
                alert("Please Enter from date");
                return false;
            }
        });
        $('#datetimepicker14').on('dp.change', function (e) {
            var lastDay = new Date();
            if ($('#datetimepicker14').val() != null && $('#datetimepicker14').val() != "") {
                var to = $("#datetimepicker14").val().split("/")
                var t = new Date(to[2], to[1] - 1, to[0])
                lastDay = t.toDateString();
                $('#todateop').val(lastDay);
            }
            else {
                alert("Please Enter from date");
                return false;
            }
        });

        function OnchangeReagent(Appointmentcode, Investigationid, InvType, service_id, unique_invstigation_id) {
            debugger;
            /*$('#progress').show();*/
            var url = "";
            url = "/TestAndInvestigation/AddInvestigationPara?service_id=" + service_id + "&Investigationid=" + Investigationid + "&Appointmentcode=" + Appointmentcode + "&unique_invstigation_id=" + unique_invstigation_id + "&InvType=" + InvType + "&reagent_id=" + $("#reagent_id").val() + "";
            $.ajax({
                url: url,
                type: "POST",
                datatype: 'json',
                async: false,
                ContentType: 'application/json;utf-8'
            }).done(function (datahtml) {
                debugger;
                /*$('#progress').hide();*/
                $("#Bind_para_body").html($(datahtml).find("#Bind_para_body").html());
                $("#bind_technician_doctor").html($(datahtml).find("#bind_technician_doctor").html());
            });
        }
        function OnchangeReagent_op(invoice_code, Investigationid, InvType, service_id, unique_invstigation_id) {
            debugger;
            /*$('#progress').show();*/
            var url = "";
            url = "/TestAndInvestigation/AddInvestigationPara_OP?service_id=" + service_id + "&investigation_id=" + Investigationid + "&invoice_code=" + invoice_code + "&unique_invstigation_id=" + unique_invstigation_id + "&InvType=" + InvType + "&reagent_id=" + $("#reagent_id_op").val() + "";
            $.ajax({
                url: url,
                type: "POST",
                datatype: 'json',
                async: false,
                ContentType: 'application/json;utf-8'
            }).done(function (datahtml) {
                debugger;
                /*$('#progress').hide();*/
                $("#Bind_para_body_op").html($(datahtml).find("#Bind_para_body_op").html());
                $("#bind_technician_doctor_op").html($(datahtml).find("#bind_technician_doctor_op").html());
            });
        }
    </script>
}
